databases:
  - name: ivie-db-final
    plan: free
    region: singapore
    databaseName: ivie_wedding
    user: ivie_user

services:
  # BACKEND
  - type: web
    name: ivie-be-final
    runtime: python
    plan: free
    region: singapore
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn ung_dung.chinh:ung_dung --bind 0.0.0.0:$PORT --workers 1 --worker-class uvicorn.workers.UvicornWorker --timeout 60
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: ivie-db-final
          property: connectionString
      - key: PORT
        value: "8000"
      - key: PYTHON_VERSION
        value: "3.12.0"
      - key: CORS_ORIGINS
        value: "https://ivie-wedding-final.onrender.com,https://ve-wedding-frontend.vercel.app,https://ivie-ad-final.onrender.com"
      - key: SECRET_KEY
        value: "ivie_wedding_secret_key_super_secure_123"

  # FRONTEND
  - type: web
    name: ivie-wedding-final
    runtime: static
    rootDir: frontend
    buildCommand: npm install --include=dev && npm run build
    staticPublishPath: ./dist
    envVars:
      - key: NODE_VERSION
        value: "22.12.0"
      - key: VITE_API_BASE_URL
        value: "https://ivie-be-final.onrender.com"
      - key: VITE_IMGBB_API_KEY
        value: "c525fc0204b449b541b0f0a5a4f5d9c4"
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

  # ADMIN - Streamlit Dashboard
  - type: web
    name: ivie-ad-final
    runtime: python
    plan: free
    region: singapore
    rootDir: admin-python
    buildCommand: pip install -r requirements.txt
    startCommand: streamlit run quan_tri.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true
    envVars:
      - key: PORT
        value: "8501"
      - key: PYTHON_VERSION
        value: "3.11.0"
      - key: API_BASE_URL
        value: "https://ivie-be-final.onrender.com"
      - key: ADMIN_USERNAME
        value: "admin"
      - key: ADMIN_PASSWORD
        value: "ivie2024"
      - key: IMGBB_API_KEY
        value: "c525fc0204b449b541b0f0a5a4f5d9c4"
